# Расчёт нагрузки

- [Расчёт нагрузки](#расчёт-нагрузки)
  - [Продуктовые метрики](#продуктовые-метрики)
    - [Сводная таблица](#сводная-таблица)
    - [Расчёт MAU, DAU и SF](#расчёт-mau-dau-и-sf)
    - [Средний размер хранилища пользователя](#средний-размер-хранилища-пользователя)
    - [Среднее количество действий пользователя](#среднее-количество-действий-пользователя)
  - [Технические метрики](#технические-метрики)
    - [Размер хранения](#размер-хранения)
    - [Сетевой трафик](#сетевой-трафик)
    - [RPC](#rpc)
  - [Список источников](#список-источников)


## Продуктовые метрики

### Сводная таблица

| MAU, млн | DAU, млн |   SF   | СРХ, шт |   СРХ, Гб   |  СКД |
| :------- | :------: | :----: | :-----: | :---------: | ---: |
| 30.5     |   5.7    | 18.6 % |  1211   | 3.6 * 10^-5 |   53 |

### Расчёт MAU, DAU и SF

Статистика по ежемесячным и ежедневным активным пользователям бралась из активных источников [1] и [2].
Sticky Factor (коэффициент липучести) считался как:

$$
  SF=\frac{DAU}{MAU}
$$


### Средний размер хранилища пользователя

Предполагается хранение истории прослушивания пользователя за последние 7 дней. Из исследования [3] получаем, что в среднем люди слушают 20.7 часов музыки в неделю.
В источнике [4] указано среднее время прослушивания для различныхх возрастных категорий. В нашем случае получаем среднее время прослушивания в соответсвии с ожидаемым распределением аудитории (расчёт в минутах):

$$
  \frac{3.51 + 3.7}{2} * 0.6 + 3.81 * 0.4 = 3.69
$$

Из расчёта, что за неделю у пользователя все треки уникальны, получаем:

$$
  \frac{20.7 * 60}{3.69} = 336
$$

Для каждого пользователя надо хранить не менее 336 строк в базе данных, содержащих информацию об недавно прослушанных треках.

Кроме того, нужно учесть лайки и дизлайки пользователя для конкретных треков. Если взять коэффициент вовлечённости в 5% и посчитать количество оценённых треков за год, то получится:

$$
  \frac{52 * 20.7 * 60}{3.69} * 0.05 = 875
$$

Итого, получаем необходимость хранить для каждого пользователя не менее 1211. При среднем размере одной строки в 32 байта, получаем объём в 38 Кб

### Среднее количество действий пользователя

Оформим различные действия в виде сводной таблицы:

| Загрузка главной страницы | Загрузка информации о треке (ИИ рекомендации) | Проставление оценки | Поиск трека | Итого |
| :------------------------ | :-------------------------------------------: | :-----------------: | :---------: | ----: |
| 2                         |                      48                       |          2          |      1      |    53 |


## Технические метрики
### Размер хранения

Из источника [4] можно получить информацию, что у аналогичной платформы (Яндекс Музыка) размер каталога не менее 75 млн треков. Из источников [5] и [6] можно получить информацию о распределении битрейта у разных треков. Стоит учитывать, что у некоторых треков имеется сразу несколько битрейтов (например FLAC и MP3).

Учитывая распределение, произведём подсчёт размера хранилища, необходимого для хранения всего каталога музыки (среднее время трека 4 минуты):

$$
  T = 4 * 60 * 75000000 \\
  0.27 * 1400 * T + 0.95 * 240 * T + 0.02 * 320 * T + 0.016 * 128 * T  + 0.014 * 192 * T \approx 1389\ Тб
$$

Также посчитаем размер метаданных, которые необходимо хранить (в среднем не более 300 байт на трек):

$$
  300 * 75000000 \approx 21 \ Гб
$$

Итого, получаем таблицу:

|            | Размер, Шт | Размер, Тб |
| :--------- | :--------: | :--------: |
| Треки      |  75000000  |    1389    |
| Метаданные |  75000000  |   0.0021   |

### Сетевой трафик

### RPC

## Список источников
https://www.statsignificant.com/p/whats-the-perfect-song-length-a-statistical
https://www.ifpi.org/ifpis-global-study-finds-were-listening-to-more-music-in-more-ways-than-ever/#:~:text=11th%20December%202023-,IFPI's%20global%20study%20finds%20we're%20listening%20to%20more,in%20more%20ways%20than%20ever&text=11th%20December%202023%20%E2%80%93%20IFPI%2C%20representing,songs%20per%20week%20in%202023.
https://yandex.ru/company/news/03-21-08-2024
https://yandexmusic.userecho.ru/communities/45/topics/2594-informatsiya-ryadom-s-trekom-ves-format-bitrejt
https://www.rbc.ru/technology_and_media/02/11/2024/67259ef99a79472b3a87096a
https://habr.com/ru/articles/837700/
